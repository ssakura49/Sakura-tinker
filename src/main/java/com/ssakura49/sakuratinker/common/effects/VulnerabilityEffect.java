package com.ssakura49.sakuratinker.common.effects;

import net.minecraft.world.effect.MobEffect;
import net.minecraft.world.effect.MobEffectCategory;
import net.minecraft.world.entity.LivingEntity;
import net.minecraft.world.entity.ai.attributes.AttributeInstance;
import net.minecraft.world.entity.ai.attributes.AttributeMap;
import net.minecraft.world.entity.ai.attributes.AttributeModifier;
import net.minecraft.world.entity.ai.attributes.Attributes;
import net.minecraftforge.event.entity.living.LivingHurtEvent;
import net.minecraftforge.eventbus.api.SubscribeEvent;

import java.util.UUID;

public class VulnerabilityEffect extends MobEffect {
    public VulnerabilityEffect() {
        super(MobEffectCategory.HARMFUL, 0xFF0000);
    }
    @Override
    public void addAttributeModifiers(LivingEntity entity, AttributeMap attributes, int amplifier) {
        super.addAttributeModifiers(entity, attributes, amplifier);
        double armorPenalty = -0.2 * (amplifier + 1);
        double currentArmor = entity.getAttributeValue(Attributes.ARMOR);
        double minArmorPenalty = -currentArmor; // 最多扣到 0
        armorPenalty = Math.max(armorPenalty, minArmorPenalty);
        AttributeInstance armorAttr = entity.getAttribute(Attributes.ARMOR);
        if (armorAttr != null) {
            armorAttr.addTransientModifier(new AttributeModifier(
                    UUID.fromString(""),
                    "armor penalty",
                    armorPenalty,
                    AttributeModifier.Operation.MULTIPLY_TOTAL
            ));
        }
    }

    @Override
    public boolean isDurationEffectTick(int duration, int amplifier) {
        return false;
    }

}
